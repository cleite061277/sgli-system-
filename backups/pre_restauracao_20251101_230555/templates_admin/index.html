{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}{{ block.super }}
<style>
    /* Estilos Customizados para o Dashboard - Limpeza e Layout */
    .dashboard-container {
        padding: 20px;
        background: #f5f7fa; /* Fundo leve para destaque */
    }
    
    .dashboard-header {
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #ddd;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .dashboard-header h1 {
        margin: 0;
    }

    /* Layout de Cards/Estat√≠sticas */
    .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        border-left: 5px solid #667eea; /* Cor principal */
        transition: transform 0.2s;
    }

    .stat-card:hover {
        transform: translateY(-2px);
    }
    
    .stat-card h3 {
        margin-top: 0;
        font-size: 14px;
        color: #777;
        font-weight: 500;
    }
    
    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #333;
    }
    
    /* Layout de Tabelas e Gr√°ficos */
    .content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr; /* Tabela principal e gr√°fico */
        gap: 30px;
        margin-bottom: 30px;
    }

    .full-width {
        grid-column: 1 / -1;
    }

    .panel {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    .panel h2 {
        margin-top: 0;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
    }
    
    /* A√ß√µes R√°pidas (Para evitar conflito, mantemos o estilo do √∫ltimo passo) */
    .actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
        margin-bottom: 30px;
    }
    .action-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 15px;
        border-radius: 8px;
        background-color: #ffffff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        color: #333;
        text-decoration: none;
        transition: transform 0.2s, box-shadow 0.2s;
        border: 1px solid #eee;
        height: 80px;
        font-weight: 600;
        font-size: 14px;
    }
    .action-card:hover {
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }
    .action-icon {
        font-size: 24px;
        margin-bottom: 5px;
    }
    
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
{% endblock %}


{% block content %}
<div class="dashboard-container">
    
    <div class="dashboard-header">
        <h1>üöÄ Dashboard Principal</h1>
        <a href="{% url 'dashboard_financeiro' %}" class="button">üí∞ Acessar Dashboard Financeiro Completo</a>
    </div>

    <h2>üõ†Ô∏è A√ß√µes R√°pidas</h2>
    <div class="actions-grid">
        <a href="{% url 'admin:core_comanda_changelist' %}" class="action-card">
            <span class="action-icon">üìÑ</span>
            Comandas
        </a>
        <a href="{% url 'admin:core_pagamento_changelist' %}" class="action-card">
            <span class="action-icon">üí≥</span>
            Pagamentos
        </a>
        <a href="{% url 'painel_whatsapp' %}" class="action-card">
            <span class="action-icon">üí¨</span>
            Painel WhatsApp
        </a>
        {# Adicione mais links de A√ß√µes R√°pidas aqui, se houver #}
    </div>

    <h2>üìä Estat√≠sticas Chave</h2>
    <div class="card-grid">
        <div class="stat-card">
            <h3>Total de Im√≥veis Ativos</h3>
            <div class="stat-value">{{ total_imoveis|default:0 }}</div>
        </div>
        <div class="stat-card">
            <h3>Contratos Ativos</h3>
            <div class="stat-value">{{ contratos_ativos|default:0 }}</div>
        </div>
        <div class="stat-card">
            <h3>Total de Locat√°rios</h3>
            <div class="stat-value">{{ total_locatarios|default:0 }}</div>
        </div>
        <div class="stat-card">
            <h3>Contratos Vencendo (60 dias)</h3>
            <div class="stat-value">{{ contratos_vencendo|default:0 }}</div>
        </div>
        <div class="stat-card">
            <h3>Receita M√™s (R$)</h3>
            <div class="stat-value">R$ {{ receita_mes|default:'0,00'|floatformat:2 }}</div>
        </div>
        <div class="stat-card" style="border-left-color: #e74c3c;">
            <h3>Taxa Inadimpl√™ncia (%)</h3>
            <div class="stat-value">{{ taxa_inadimplencia|default:'0' }}%</div>
        </div>
    </div>


    <div class="panel full-width">
        <h2>üö® Comandas Vencidas (Atraso)</h2>
        {% if comandas_vencidas %}
            <div class="module">
                <table id="comandas-vencidas">
                    <thead>
                        <tr>
                            <th>{% translate 'Locat√°rio' %}</th>
                            <th>{% translate 'Im√≥vel' %}</th>
                            <th>{% translate 'Vencimento' %}</th>
                            <th>{% translate 'Valor Total' %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for comanda in comandas_vencidas %}
                        <tr>
                            <td><a href="{% url 'admin:core_locatario_change' comanda.locacao.locatario.pk %}">{{ comanda.locacao.locatario.nome_razao_social }}</a></td>
                            <td>{{ comanda.locacao.imovel.endereco_completo_curto }}</td>
                            <td>{{ comanda.data_vencimento|date:"d/m/Y" }}</td>
                            <td>R$ {{ comanda.valor_total_calculado|floatformat:2 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>{% translate 'Nenhuma comanda em atraso nas √∫ltimas 4 semanas.' %}</p>
        {% endif %}
    </div>

    
    <div class="full-width panel">
        <h2>{% translate 'Modelos de Dados do Sistema' %}</h2>
        {# Chamada CORRIGIDA para evitar a triplica√ß√£o #}
        {% if app_list %}
            {% for app in app_list %}
                <div class="module{% if app.app_url %} app-{{ app.name|lower }}{% endif %}">
                    {% include "admin/includes/app_list.html" with app=app %}
                </div>
            {% endfor %}
        {% else %}
            <p>{% translate 'No apps installed that provide models' %}</p>
        {% endif %}
    </div>
</div>

{# Removemos o script do gr√°fico de Formas de Pagamento, pois ele faz parte do Dashboard Financeiro completo #}

{% endblock %}
